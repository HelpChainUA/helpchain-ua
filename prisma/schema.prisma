generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  JOB_SEEKER
  EMPLOYER
  PARTNER
}

enum HousingAssistance {
  YES
  NO
  POSSIBLE
}

enum HousingAssistancePreference {
  NO
  JOB_WITH_HOUSING_ONLY
  NEED_HELP_MOVING
  CONSIDERING_OPTIONS
}


enum OpportunityType {
  COURSES
  ENGLISH_CLASSES
  INTERNSHIPS
  PAID_WORK_ONLY
}

enum EmploymentTypePreference {
  FULL_TIME
  PART_TIME
  BOTH_FLEXIBLE
}

enum ExperienceRange {
  YEARS_0_1
  YEARS_1_2
  YEARS_3_5
  YEARS_6_10
  YEARS_10_PLUS
}

enum AgeRange {
  AGE_18_24
  AGE_25_29
  AGE_30_34
  AGE_35_39
  AGE_40_44
  AGE_45_54
  AGE_55_PLUS
}

model Language {
  id       Int    @id @default(autoincrement())
  name     String
  users    UserLangLevel[]
}

model LanguageLevel {
  id       Int    @id @default(autoincrement())
  name     String
  users    UserLangLevel[]
}

model UserLangLevel {
  userId     Int
  languageId Int
  levelId    Int

  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  language   Language      @relation(fields: [languageId], references: [id])
  level      LanguageLevel @relation(fields: [levelId], references: [id])

  @@id([userId, languageId]) // композитний ключ
}

model UserJobLocation {
  userId     Int
  locationId String

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@id([userId, locationId])
}

model JobOption {
  id               String             @id @default(cuid())
  slug             String             @unique
  label            String
  createdAt        DateTime           @default(now())
  userJobOptions   UserJobOption[]
  companyJobOptions CompanyJobOption[]
  vacancyJobOptions VacancyJobOption[]
  workExperiences  UserWorkExperience[]
}

model UserWorkExperience {
  userId       Int
  jobOptionId  String
  yearsRange   ExperienceRange

  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobOption    JobOption @relation(fields: [jobOptionId], references: [id], onDelete: Cascade)

  @@id([userId, jobOptionId])
}

model UserJobOption {
  userId       Int
  jobOptionId  String

  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobOption    JobOption @relation(fields: [jobOptionId], references: [id], onDelete: Cascade)

  @@id([userId, jobOptionId])
}

model CompanyJobOption {
  companyId    String
  jobOptionId  String

  company      Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobOption    JobOption @relation(fields: [jobOptionId], references: [id], onDelete: Cascade)

  @@id([companyId, jobOptionId])
}

model VacancyJobOption {
  jobId        String
  jobOptionId  String

  job          Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobOption    JobOption @relation(fields: [jobOptionId], references: [id], onDelete: Cascade)

  @@id([jobId, jobOptionId])
}

model UserOpportunity {
  userId Int
  type   OpportunityType

  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, type])
}

model UserEmploymentType {
  userId Int
  type   EmploymentTypePreference

  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, type])
}

model User {
  id                 Int       @id @default(autoincrement())
  name               String?
  email              String    @unique
  emailVerified      DateTime?
  password           String?
  locationId         String?
  onboardingStep     Int       @default(1)
  image              String?
  createdAt          DateTime  @default(now())
  resetPasswordToken String?  @unique
  resetPasswordTokenExpiry DateTime?
  emailVerificationToken String?   @unique
  emailVerificationExpiry DateTime?

  // User role
  role               UserRole?
  phoneNumber        String?

  // Profile fields
  firstName          String?
  lastName           String?
  ageRange           AgeRange?
  gender             String?
  currentRole        String?
  desiredRole        String?
  skills             Json?
  willingToRetrain   Boolean?  @default(false)
  willingToRelocate  Boolean?  @default(false)
  housingAssistancePreference HousingAssistancePreference?
  targetJobs         UserJobOption[]
  workExperiences    UserWorkExperience[]
  opportunities      UserOpportunity[]
  employmentTypes    UserEmploymentType[]

  languageSkills     Json?
  workExperienceSummary String? @db.Text
  salary             String?

  accounts           Account[]
  sessions           Session[]
  cvs                Cv[]
  languages          UserLangLevel[]
  company            Company?
  location           Location? @relation(fields: [locationId], references: [id])
  jobSearchLocations UserJobLocation[]
}

model Account {
  id                 Int       @id @default(autoincrement())
  userId             Int
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?    @db.Text
  access_token       String?    @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?    @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           Int      @id @default(autoincrement())
  sessionToken String   @unique
  userId       Int
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Cv {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  fileUrl   String   // link to file (can be local or S3)
  createdAt DateTime @default(now())
}

model Company {
  id                      String   @id @default(cuid())
  userId                  Int      @unique
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyName             String
  companyWebsite          String?
  companyLinkedIn         String?
  
  companySizeId           String?
  companySize             CompanySize? @relation(fields: [companySizeId], references: [id])
  
  industries              CompanyIndustry[]
  locations               CompanyLocation[]
  jobs                    Job[]
  jobOptions              CompanyJobOption[]
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model Industry {
  id                String              @id @default(cuid())
  name              String              @unique
  companies         CompanyIndustry[]
}

model CompanyIndustry {
  companyId         String
  industryId        String
  company           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  industry          Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)
  
  @@id([companyId, industryId])
}

model CompanySize {
  id                String    @id @default(cuid())
  name              String    @unique
  companies         Company[]
}

model Location {
  id                String              @id @default(cuid())
  city              String
  country           String              @default("United Kingdom")
  
  companyLocations  CompanyLocation[]
  jobs              Job[]
  users             User[]
  jobSearchUsers     UserJobLocation[]
  
  @@unique([city, country])
}

model CompanyLocation {
  companyId         String
  locationId        String
  company           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  location          Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  
  @@id([companyId, locationId])
}

model JobType {
  id            String             @id @default(cuid())
  name          String             @unique // PAID_JOB, INTERNSHIP, VOLUNTEERING
  displayName   String             // "Paid Job", "Internship", "Volunteering"
  jobs          JobTypeRelation[]
  createdAt     DateTime           @default(now())
}

model JobTypeRelation {
  jobId     String
  jobTypeId String
  job       Job     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobType   JobType @relation(fields: [jobTypeId], references: [id], onDelete: Cascade)
  
  @@id([jobId, jobTypeId])
}

model WorkType {
  id            String   @id @default(cuid())
  name          String   @unique // FULL_TIME, PART_TIME, FLEXIBLE
  displayName   String   // "Full-time", "Part-time", "Both / Flexible"
  jobs          Job[]
  createdAt     DateTime @default(now())
}

model Job {
  id                String   @id @default(cuid())
  companyId         String
  company           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  title             String
  types             JobTypeRelation[] // many-to-many
  
  locationId        String?
  location          Location? @relation(fields: [locationId], references: [id])
  
  housingAssistance HousingAssistance
  workTypeId        String?
  workType          WorkType? @relation(fields: [workTypeId], references: [id]) // one-to-many
  jobOptions        VacancyJobOption[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}  
